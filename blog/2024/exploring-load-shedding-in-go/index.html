<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Building a Load-Shedding System in Go. Prioritizing Tasks Under Heavy Load | Omar Elweshy </title> <meta name="author" content="Omar Elweshy"> <meta name="description" content="Learn how to build a load-shedding system in Go to prioritize critical tasks under heavy load. This guide simulates real-world scenarios, like handling video playback and analytics, using task queues, priority-based logic, and worker pools to keep systems responsive. Perfect for exploring backend resilience techniques!"> <meta name="keywords" content="Omar Elweshy, Backend Engineer, DevOps, Software Development, Waared, Logistics Solutions, Automation, Problem Solving, Backend Systems, Linux, Coding"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%91%F0%9F%8F%BB%E2%80%8D%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://weshydev.github.io/blog/2024/exploring-load-shedding-in-go/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Omar</span> Elweshy </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/resume">Resume </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Building a Load-Shedding System in Go. Prioritizing Tasks Under Heavy Load</h1> <p class="post-meta"> Created in November 23, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/distributed-systems"> <i class="fa-solid fa-hashtag fa-sm"></i> distributed-systems</a>   ·   <a href="/blog/category/backend"> <i class="fa-solid fa-tag fa-sm"></i> backend</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Have you ever wondered how big tech companies keep their services running smoothly, even when millions of users are online at the same time? One of the secrets behind this magic is a concept called <strong>load shedding</strong>. In this blog post, we’ll dive into what load shedding is and build a small-scale system in Go to see it in action.</p> <h2 id="real-life-scenario-video-streaming-platform"><strong>Real-Life Scenario: Video Streaming Platform</strong></h2> <p>Imagine you’re running a popular video streaming platform. Users request video playback, subtitles, recommendations, and analytics. But when traffic become heavy say, during the release of a new movie, your servers can’t handle everything at once. Here’s what happens:</p> <ol> <li> <strong>Critical Task</strong>: Delivering the video playback stream is non-negotiable.</li> <li> <strong>Important Task</strong>: Subtitles and audio syncing enhance user experience but aren’t as critical as playback.</li> <li> <strong>Optional Task</strong>: Collecting analytics for recommendations is great but can be dropped without affecting users.</li> </ol> <p><strong>Load shedding</strong> ensures your system prioritizes the playback stream and subtitles while shedding analytics during heavy traffic.</p> <h2 id="the-plan"><strong>The Plan</strong></h2> <p>We’ll create:</p> <ol> <li> <strong>Task Generator</strong>: Simulates user requests (e.g., playback, subtitles, analytics).</li> <li> <strong>Load Manager</strong>: Decides which tasks to accept or drop based on system load.</li> <li> <strong>Worker Pool</strong>: Processes tasks concurrently.</li> <li> <strong>Logger</strong>: Tracks accepted, processed, and dropped tasks.</li> </ol> <h2 id="step-1-task-structure"><strong>Step 1: Task Structure</strong></h2> <p>First, define the structure of a task in Go:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"math/rand"</span>
	<span class="s">"sync"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">Task</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">ID</span>       <span class="kt">int</span>
	<span class="n">Priority</span> <span class="kt">string</span>
	<span class="n">Duration</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span>
<span class="p">}</span>
</code></pre></div></div> <p>Each task represents a user request. For example:</p> <ul> <li> <strong>Playback</strong>: High priority</li> <li> <strong>Subtitles</strong>: Medium priority</li> <li> <strong>Analytics</strong>: Low priority</li> </ul> <h2 id="step-2-load-manager"><strong>Step 2: Load Manager</strong></h2> <p>The Load Manager controls the system’s task queue and ensures only tasks within capacity are processed.</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">LoadManager</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">mu</span>          <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>
	<span class="n">taskQueue</span>   <span class="p">[]</span><span class="n">Task</span>
	<span class="n">maxCapacity</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">NewLoadManager</span><span class="p">(</span><span class="n">capacity</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="n">LoadManager</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">LoadManager</span><span class="p">{</span>
		<span class="n">taskQueue</span><span class="o">:</span>   <span class="nb">make</span><span class="p">([]</span><span class="n">Task</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
		<span class="n">maxCapacity</span><span class="o">:</span> <span class="n">capacity</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Accepting Tasks</strong></p> <p>Tasks are accepted or dropped based on priority:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">lm</span> <span class="o">*</span><span class="n">LoadManager</span><span class="p">)</span> <span class="n">AcceptTask</span><span class="p">(</span><span class="n">task</span> <span class="n">Task</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="n">lm</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
	<span class="k">defer</span> <span class="n">lm</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">lm</span><span class="o">.</span><span class="n">maxCapacity</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">Priority</span> <span class="o">==</span> <span class="s">"Low"</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Task %d dropped (Analytics - Low priority)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
			<span class="k">return</span> <span class="no">false</span>
		<span class="p">}</span>
		<span class="n">lm</span><span class="o">.</span><span class="n">shedLoad</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Priority</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Task %d accepted (Priority: %s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">Priority</span><span class="p">)</span>
	<span class="k">return</span> <span class="no">true</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Shedding Load</strong></p> <p>When capacity is full, the system drops lower-priority tasks to make space:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">lm</span> <span class="o">*</span><span class="n">LoadManager</span><span class="p">)</span> <span class="n">shedLoad</span><span class="p">(</span><span class="n">minPriority</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">priorities</span> <span class="o">:=</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">"High"</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span> <span class="s">"Medium"</span><span class="o">:</span> <span class="m">2</span><span class="p">,</span> <span class="s">"Low"</span><span class="o">:</span> <span class="m">3</span><span class="p">}</span>

	<span class="n">newQueue</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="n">Task</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">task</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">priorities</span><span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">Priority</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">priorities</span><span class="p">[</span><span class="n">minPriority</span><span class="p">]</span> <span class="p">{</span>
			<span class="n">newQueue</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">newQueue</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Task %d shed (Priority: %s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">Priority</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span> <span class="o">=</span> <span class="n">newQueue</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Fetching Tasks for Processing</strong></p> <p>Workers will use this function to fetch tasks:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">lm</span> <span class="o">*</span><span class="n">LoadManager</span><span class="p">)</span> <span class="n">GetNextTask</span><span class="p">()</span> <span class="o">*</span><span class="n">Task</span> <span class="p">{</span>
	<span class="n">lm</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
	<span class="k">defer</span> <span class="n">lm</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="no">nil</span>
	<span class="p">}</span>

	<span class="n">task</span> <span class="o">:=</span> <span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
	<span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">taskQueue</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">]</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">task</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="step-3-worker-pool"><strong>Step 3: Worker Pool</strong></h2> <p>Workers process accepted tasks concurrently:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">worker</span><span class="p">(</span><span class="n">id</span> <span class="kt">int</span><span class="p">,</span> <span class="n">lm</span> <span class="o">*</span><span class="n">LoadManager</span><span class="p">,</span> <span class="n">wg</span> <span class="o">*</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>

	<span class="k">for</span> <span class="p">{</span>
		<span class="n">task</span> <span class="o">:=</span> <span class="n">lm</span><span class="o">.</span><span class="n">GetNextTask</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">100</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="p">}</span>

		<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Worker %d processing task %d (Priority: %s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">Priority</span><span class="p">)</span>
		<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="step-4-task-generator"><strong>Step 4: Task Generator</strong></h2> <p>Generate user requests with random priorities and durations:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">generateTask</span><span class="p">(</span><span class="n">id</span> <span class="kt">int</span><span class="p">)</span> <span class="n">Task</span> <span class="p">{</span>
	<span class="n">priorities</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"High"</span><span class="p">,</span> <span class="s">"Medium"</span><span class="p">,</span> <span class="s">"Low"</span><span class="p">}</span>
	<span class="n">duration</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="m">2000</span><span class="p">)</span><span class="o">+</span><span class="m">500</span><span class="p">)</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span>

	<span class="k">return</span> <span class="n">Task</span><span class="p">{</span>
		<span class="n">ID</span><span class="o">:</span>       <span class="n">id</span><span class="p">,</span>
		<span class="n">Priority</span><span class="o">:</span> <span class="n">priorities</span><span class="p">[</span><span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">priorities</span><span class="p">))],</span>
		<span class="n">Duration</span><span class="o">:</span> <span class="n">duration</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div> <h2 id="step-5-main-function"><strong>Step 5: Main Function</strong></h2> <p>Combine everything to simulate the load-shedding system:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">rand</span><span class="o">.</span><span class="n">Seed</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">())</span>

	<span class="n">maxCapacity</span> <span class="o">:=</span> <span class="m">10</span>
	<span class="n">numWorkers</span> <span class="o">:=</span> <span class="m">3</span>
	<span class="n">totalTasks</span> <span class="o">:=</span> <span class="m">50</span>

	<span class="n">loadManager</span> <span class="o">:=</span> <span class="n">NewLoadManager</span><span class="p">(</span><span class="n">maxCapacity</span><span class="p">)</span>
	<span class="k">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">numWorkers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
		<span class="k">go</span> <span class="n">worker</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">loadManager</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wg</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="n">id</span> <span class="o">:=</span> <span class="m">1</span><span class="p">;</span> <span class="n">id</span> <span class="o">&lt;=</span> <span class="n">totalTasks</span><span class="p">;</span> <span class="n">id</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">task</span> <span class="o">:=</span> <span class="n">generateTask</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
		<span class="n">loadManager</span><span class="o">.</span><span class="n">AcceptTask</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
		<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="m">500</span><span class="p">))</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="p">)</span>
	<span class="p">}</span>
	
	<span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="step-6-running-the-program"><strong>Step 6: Running the Program</strong></h2> <p>Save your code in <code class="language-plaintext highlighter-rouge">main.go</code> and run it:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go run main.go
</code></pre></div></div> <h2 id="what-youll-see"><strong>What You’ll See</strong></h2> <p>The logs will show something like this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Task 1 accepted <span class="o">(</span>Priority: Medium<span class="o">)</span>
Task 2 accepted <span class="o">(</span>Priority: Low<span class="o">)</span>
Task 3 accepted <span class="o">(</span>Priority: High<span class="o">)</span>
Worker 1 processing task 1 <span class="o">(</span>Priority: Medium<span class="o">)</span>
Worker 2 processing task 3 <span class="o">(</span>Priority: High<span class="o">)</span>
Task 15 dropped <span class="o">(</span>Low priority<span class="o">)</span>
Task 18 shed <span class="o">(</span>Priority: Low<span class="o">)</span>
</code></pre></div></div> <p><strong>Key Observations</strong>:</p> <ul> <li>High-priority tasks (e.g., playback) are always accepted.</li> <li>Medium-priority tasks (e.g., subtitles) are processed when capacity allows.</li> <li>Low-priority tasks (e.g., analytics) are the first to be dropped under heavy load.</li> </ul> <h2 id="conclusion">Conclusion</h2> <p>This system mirrors real-world scenarios like video streaming platforms prioritizing playback and subtitles over analytics. Understanding and implementing load shedding is essential for building resilient systems that can handle high traffic without buckling under pressure.</p> <p>You can find the complete code on <a href="https://github.com/omarelweshy/golang-load-shedding" rel="external nofollow noopener" target="_blank">Github</a></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/how-to-create-load-balancer-with-nginx-and-docker/">How To Create Load Balancer With Nginx And Docker</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/how-to-manage-dotfiles/">How To Manage Dotfiles</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Omar Elweshy. Last updated: November 25, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-repositories",title:"Repositories",description:"",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"nav-resume",title:"Resume",description:"",section:"Navigation",handler:()=>{window.location.href="/resume"}},{id:"post-building-a-load-shedding-system-in-go-prioritizing-tasks-under-heavy-load",title:"Building a Load-Shedding System in Go. Prioritizing Tasks Under Heavy Load",description:"Learn how to build a load-shedding system in Go to prioritize critical tasks under heavy load. This guide simulates real-world scenarios, like handling video playback and analytics, using task queues, priority-based logic, and worker pools to keep systems responsive. Perfect for exploring backend resilience techniques!",section:"Posts",handler:()=>{window.location.href="/blog/2024/exploring-load-shedding-in-go/"}},{id:"post-how-to-create-load-balancer-with-nginx-and-docker",title:"How To Create Load Balancer With Nginx And Docker",description:"It's crucial to ensure that your web applications are always available and can handle high traffic. That's where a load balancer comes in.",section:"Posts",handler:()=>{window.location.href="/blog/2022/how-to-create-load-balancer-with-nginx-and-docker/"}},{id:"post-how-to-manage-dotfiles",title:"How To Manage Dotfiles",description:"When your OS crashes or you needed to change it, so?",section:"Posts",handler:()=>{window.location.href="/blog/2021/how-to-manage-dotfiles/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"projects-project-1",title:"project 1",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"projects-project-2",title:"project 2",description:"a project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/2_project/"}},{id:"projects-project-3-with-very-long-name",title:"project 3 with very long name",description:"a project that redirects to another website",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-project-4",title:"project 4",description:"another without an image",section:"Projects",handler:()=>{window.location.href="/projects/4_project/"}},{id:"projects-project-5",title:"project 5",description:"a project with a background image",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-project-6",title:"project 6",description:"a project with no image",section:"Projects",handler:()=>{window.location.href="/projects/6_project/"}},{id:"projects-project-7",title:"project 7",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/7_project/"}},{id:"projects-project-8",title:"project 8",description:"an other project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/8_project/"}},{id:"projects-project-9",title:"project 9",description:"another project with an image \ud83c\udf89",section:"Projects",handler:()=>{window.location.href="/projects/9_project/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%6F%6D%61%72%65%6C%77%65%73%68%79@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/omarelweshy","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/omarelweshy","_blank")}},{id:"socials-x",title:"X",description:"Twitter",section:"Socials",handler:()=>{window.open("https://twitter.com/omarelweshy","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>